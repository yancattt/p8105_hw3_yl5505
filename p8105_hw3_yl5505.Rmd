---
title: "p8105_hw3_yl5505"
author: "Yan Li"
date: "2024-10-11"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)
library(knitr)
library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r}
library(p8105.datasets)
data("ny_noaa")
```
# Problem 1

## Overview

```{r}
ny_noaa

summarize(ny_noaa, rows = n(), columns = ncol(ny_noaa))

summarize(ny_noaa, across(everything(), ~mean(is.na(.))))
```

-- This dataset is a weather dataset, it has 2595176 rows and 7 variables
- `id`: Weather station ID
- `date`: Date of observation
- `prcp`: Precipitation (tenths of mm)
- `snow`: Snowfall (mm)
- `snwd`: Snow depth (mm)
- `tmax`: Maximum temperature (tenths of degrees C)
- `tmin`: Minimum temperature (tenths of degrees C)
-- There are many columns with missing data. tmax and tmin have about 44% data missing, snow has 15%, and snwd has 23%. Missing data could cause bias or make the dataset less reliable for certain analyses. 

## Data cleaning
- create new variables
```{r}
noaa_cleaned = ny_noaa |>
  mutate(
    year = as.numeric(format(date, "%Y")),
    month = as.numeric(format(date, "%m")),
    day = as.numeric(format(date, "%d"))
  )
noaa_cleaned
```
- unit conversion 
```{r}
noaa_cleaned = ny_noaa |>
  mutate(
     tmax = as.numeric(tmax) / 10,
    tmin = as.numeric(tmin) / 10,
    prcp = as.numeric(prcp) / 10
  )
noaa_cleaned
```
- most common snowfall value
```{r}
noaa_cleaned = ny_noaa |>
  count(snow) |>
  arrange(desc(n))

noaa_cleaned
```
-- The most commonly observed snowfall value is 0 mm, it mean that on most days there was no snowfall recorded. It is reasonable becasue New York does not snow a lot considering its location and geography. 

## Two-panel plot
```{r}


```

#Problem 2
```{r}
hw_covar = read_csv("nhanes_covar.csv",skip = 4 )|>
  janitor::clean_names()

hw_accel = read_csv("nhanes_accel.csv")|>
  janitor::clean_names()

```
- merge two dataset
```{r}
hw_ac = inner_join(hw_accel, hw_covar, by = "seqn")
hw_ac
```

```{r}
ac_clean = hw_ac |>
  filter(age >= 21) |>
  drop_na()|>
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("male", "female")),
    education = factor(education, levels = c(1, 2, 3), labels = c("Less than high school", "High school equivalent", "More than high school"))
  )
```




## create table for the number of men and women in each education category
```{r}
edu_table = ac_clean |>
  group_by(education, sex) |>
  summarize(count = n(), .groups = "drop") |>
  pivot_wider(names_from = sex, values_from = count, values_fill = 0)

edu_table|>kable()
```

## create plot
```{r}
ggplot(ac_clean, aes(x = education, y = age, fill = sex)) +
  geom_boxplot(alpha = 0.7) +
  scale_fill_manual(values = c("male" = "#1f77b4", "female" = "#ff7f0e")) +
  labs(
    title = "Age Distribution by Education Level and Gender",
    x = "Education Level",
    y = "Age",
    fill = "Gender"
  )
```
- The table shows the gender distribution across education levels,and the "High school equivalent" group has fewer females compared to males.
- The boxplot shows that, in "More than high school", the age distribution is more concentrated, with a visible peak in the 40-45 age range for both men and women.
- Greater variability in age for males across all education levels.

## Total activity Plot

```{r}
ac_clean |>
  pivot_longer(
    min1:min1440,
    names_to = "minute",                
    names_prefix = "min",
    values_to = "activity_value"        
  ) |>
  group_by(seqn, sex, age, education) |>
  summarize(total_activity = sum(activity_value, na.rm = TRUE)) |>
  ggplot(aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = 0.5) +            
  geom_smooth(se = FALSE) +   
  facet_wrap(~ education) + 
  labs(
    title = "Total Daily Activity vs Age by Education Level and Gender",
    x = "Age",
    y = "Total Daily Activity"
  )

```
-The plot shows that physical activity declines with age regardless of education level.
-The trend of higher activity levels among those with more education may indicate that education contributes to increased health awareness.
-In general, women (yellow line) show slightly higher peaks in activity in the younger age groups compared to men.


## 24-hour activity

```{r}
ac_clean |>
  pivot_longer(
    min1:min1440,
    names_to = "minute",
    names_prefix = "min",
    values_to = "activity_value"
  ) |>
  mutate(minute = as.numeric(minute)) |>
  group_by(minute, sex, education) |>
  summarize(mean_activity = mean(activity_value, na.rm = TRUE), .groups = "drop") |>
  ggplot(aes(x = minute, y = mean_activity, color = sex)) +
  geom_line(size = 1, alpha = 0.7) + 
  facet_wrap(~ education) +        
  scale_x_continuous(               
    breaks = seq(0, 1440, by = 240), 
    labels = c("Midnight", "4 AM", "8 AM", "Noon", "4 PM", "8 PM", "Midnight")
  ) +
  labs(
    title = "24-Hour Activity Time Courses by Education Level and Gender",
    x = "Minute of the Day",
    y = "Mean Activity Level",
    color = "Gender"
  )
```






